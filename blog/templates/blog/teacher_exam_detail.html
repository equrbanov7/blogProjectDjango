{% extends "base.html" %}
{% load static %}

{% block title %}{{ exam.title }}{% endblock %}

{% block extraCss %}
    {# Yeni CSS faylƒ±nƒ± qo≈üuruq #}
    <link rel="stylesheet" href="{% static 'css/teacher_exam_detail.css' %}">
{% endblock %}

{% block content %}
<div class="exam-detail-page-wrapper">
    <div class="exam-detail-card">
        <div class="card-header">
            <h1 class="exam-detail-title">{{ exam.title }}</h1>
            <p class="exam-detail-description">{{ exam.description }}</p>
        </div>

        <div class="card-body">
            {# --- ƒ∞mtahan M…ôlumatlarƒ± Hiss…ôsi --- #}
            <section class="exam-info-section">
                <div class="info-item">
                    <span class="info-label"><i class="fas fa-file-alt"></i> Tip:</span>
                    <span class="info-value">{{ exam.get_exam_type_display }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label"><i class="fas fa-info-circle"></i> Status:</span>
                    {% if exam.is_active %}
                        <span class="status-badge active">Aktiv</span>
                    {% else %}
                        <span class="status-badge passive">Passiv</span>
                    {% endif %}
                </div>
                {% if exam.total_duration_minutes %}
                <div class="info-item">
                    <span class="info-label"><i class="far fa-clock"></i> √úmumi M√ºdd…ôt:</span>
                    <span class="info-value">{{ exam.total_duration_minutes }} d…ôqiq…ô</span>
                </div>
                {% endif %}
                {% if exam.default_question_time_seconds %}
                <div class="info-item">
                    <span class="info-label"><i class="fas fa-stopwatch"></i> Sual Vaxtƒ±:</span>
                    <span class="info-value">{{ exam.default_question_time_seconds }} saniy…ô</span>
                </div>
                {% endif %}
                {% if exam.max_attempts_per_user %}
                <div class="info-item">
                    <span class="info-label"><i class="fas fa-redo-alt"></i> C…ôhdl…ôr:</span>
                    <span class="info-value">{{ exam.max_attempts_per_user }}</span>
                </div>
                {% endif %}

                <a href="{% url 'liveExam:create_session_slug' slug=exam.slug %}"
                class="btn btn-success">
                üöÄ Live ba≈ülat
                </a>

            </section>

            {# --- ƒ∞mtahan H…ôr…ôk…ôtl…ôri (D√ºym…ôl…ôr) Hiss…ôsi --- #}
            <section class="exam-actions-section">
                <div class="action-group">
                    <a href="{% url 'add_exam_question' exam.slug %}" class="action-btn primary-btn">
                        <i class="fas fa-plus-circle"></i> Yeni sual …ôlav…ô et
                    </a>
                  {# Sual Bankƒ± D√ºym…ôsi #}
                    {% if exam.exam_type == "test" %}
                        <a href="{% url 'test_question_bank' exam.slug %}"
                        class="action-btn info-btn"
                        style="background-color: #6c5ce7; color: white;">
                            <i class="fas fa-layer-group"></i> Sual Bankƒ± / Bloklar
                        </a>
                        {% else %}
                        <a href="{% url 'create_question_bank' exam.slug %}"
                        class="action-btn info-btn"
                        style="background-color: #6c5ce7; color: white;">
                            <i class="fas fa-layer-group"></i> Sual Bankƒ± / Bloklar
                        </a>
                    {% endif %}

                    <a href="{% url 'teacher_exam_results' exam.slug %}" class="action-btn secondary-btn">
                        <i class="fas fa-poll"></i> N…ôtic…ôl…ôr…ô bax
                    </a>
                </div>
                <div class="action-group">
                    <form method="post" action="{% url 'toggle_exam_active' exam.slug %}">
                        {% csrf_token %}
                        {% if exam.is_active %}
                            <button type="submit" class="action-btn warning-btn">
                                <i class="fas fa-pause-circle"></i> Deaktiv et
                            </button>
                        {% else %}
                            <button type="submit" class="action-btn success-btn">
                                <i class="fas fa-play-circle"></i> Aktiv et
                            </button>
                        {% endif %}
                    </form>
                    <a href="{% url 'edit_exam' exam.slug %}" class="action-btn outline-btn">
                        <i class="fas fa-edit"></i> Redakt…ô et
                    </a>
                    <form method="post" action="{% url 'delete_exam' exam.slug %}"
                          onsubmit="return confirm('Bu imtahanƒ± silm…ôy…ô …ôminsiniz?');">
                        {% csrf_token %}
                        <button type="submit" class="action-btn danger-btn">
                            <i class="fas fa-trash-alt"></i> Sil
                        </button>
                    </form>
                </div>
            </section>

            {# --- M√∂vcud Suallar Hiss…ôsi --- #}
            <section class="questions-section">
                <h2 class="section-title">M√∂vcud suallar</h2>
                {% if questions %}
                    <ol class="question-list">
                        {% for q in questions %}
                        <li class="question-item">
                            <div class="question-content">
                                <span class="question-order">{{ q.order }}.</span>
                                <p class="question-text">{{ q.text }}</p>

                                {% if exam.exam_type == "test" %}
                                    <ul class="options-list">
                                        {% for opt in q.options.all %}
                                            <li class="option-item {% if opt.is_correct %}correct{% endif %}">
                                                <span class="option-indicator">
                                                    {% if opt.is_correct %}<i class="fas fa-check-circle"></i>{% else %}<i class="far fa-circle"></i>{% endif %}
                                                </span>
                                                <span class="option-text">{{ opt.text }}</span>
                                            </li>
                                        {% endfor %}
                                    </ul>
                                {% endif %}
                            </div>
                            <div class="question-actions">
                                <a href="{% url 'edit_exam_question' exam.slug q.id %}"
                                   class="action-btn outline-btn-sm">
                                    <i class="fas fa-edit"></i> Edit
                                </a>
                                <form method="post"
                                      action="{% url 'delete_exam_question' exam.slug q.id %}"
                                      onsubmit="return confirm('Bu sualƒ± silm…ôy…ô …ôminsiniz?');">
                                    {% csrf_token %}
                                    <button type="submit" class="action-btn danger-btn-sm">
                                        <i class="fas fa-trash-alt"></i> Delete
                                    </button>
                                </form>
                            </div>
                        </li>
                        {% endfor %}
                    </ol>
                {% else %}
                    <div class="empty-state-questions">
                        <div class="empty-icon"><i class="far fa-lightbulb"></i></div>
                        <p>Bu imtahan √º√ß√ºn h…ôl…ô sual …ôlav…ô etm…ômisiniz.</p>
                        <a href="{% url 'add_exam_question' exam.slug %}" class="action-btn primary-btn-sm">ƒ∞lk sualƒ± …ôlav…ô et</a>
                    </div>
                {% endif %}
            </section>
        </div>
    </div>
</div>
{% endblock %}