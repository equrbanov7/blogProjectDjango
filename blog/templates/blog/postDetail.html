{% extends 'base.html' %}
{% load static %}

{% block title %}{{ post.title }} | My Blog{% endblock %}

{% block extraCss %}
    <link rel="stylesheet" href="{% static 'css/postDetail.css' %}">
{% endblock %}

{% block content %}
<div class="article-page-wrapper"> {# √úmumi s…ôhif…ô konteyneri #}
    <article class="article-container">
        
        <header class="article-header">
            {% if post.category %}
                <a href="#" class="article-category">
                    <i class="fas fa-tag"></i> {{ post.category.name }}
                </a> {# Kateqoriyaya link v…ô ikon #}
            {% endif %}
            
            <h1 class="article-title">{{ post.title }}</h1>
            
            <div class="article-meta">
                <span><i class="far fa-calendar-alt"></i> {{ post.created_at|date:"d M Y" }}</span>
                {% if post.author %}
                    <span>‚Ä¢ <a href="{% url 'user_profile' post.author.username %}" class="author-link"><i class="fas fa-user-circle"></i> {{ post.author.username }}</a></span>
                {% endif %}
                {% if post.average_rating %}
                    <span>‚Ä¢ <i class="fas fa-star"></i> {{ post.average_rating|floatformat:1 }} / 5</span>
                {% endif %}
            </div>
        </header>

        {% if post.image_url %}
            <img src="{{ post.image_url }}" alt="{{ post.title }}" class="article-featured-image">
        {% else %}
            <img src="{% static 'img/tech-placeholder.svg' %}" alt="Default Blog Image" class="article-featured-image">
        {% endif %}

        <div class="article-content">
            {# ∆èg…ôr excerpt g√∂st…ôrm…ôk ist…ôyirs…ôns…ô, …ôvv…ôlc…ô qƒ±sa t…ôsviri ver…ô bil…ôrs…ôn #}
            {% if post.excerpt %}
                <p class="article-excerpt">
                    **{{ post.excerpt|linebreaks }}** {# Qƒ±sa t…ôsviri bold etdim #}
                </p>
                <hr>
            {% endif %}

            {{ post.content|linebreaks }} 
        </div>

       

    </article>

    {# ------- RATING & COMMENTS B√ñLM∆èSƒ∞ ------- #}
    <section class="article-extra-section"> {# Yeni konteyner #}
        <div class="article-rating-block">
            {% if post.average_rating %}
                <p>M…ôqal…ônin orta reytinqi: <strong>{{ post.average_rating|floatformat:1 }}</strong> <i class="fas fa-star"></i> / 5</p>
            {% else %}
                <p>Bu m…ôqal…ô √º√ß√ºn h…ôl…ô reytinq yoxdur.</p>
            {% endif %}
        </div>

        <div class="comments-section"> {# article-comments -> comments-section #}
            <h2 class="comments-title">≈û…ôrhl…ôr ({{ comments.count }})</h2>

            {% for comment in comments %}
                <article class="comment-item">
                    <header class="comment-header">
                        <strong class="comment-author">{{ comment.user.username }}</strong>
                        <span class="comment-meta">
                            {{ comment.created_at|date:"d M Y H:i" }} ‚Ä¢ 
                            <span class="star-rating">
                                {% for _ in ""|ljust:comment.rating %} <i class="fas fa-star"></i> {% endfor %} {# Reytinq ulduzlarƒ± #}
                            </span>
                        </span>
                    </header>
                    <p class="comment-text">{{ comment.text|linebreaks }}</p>
                </article>
            {% empty %}
                <p>H…ôl…ô ≈ü…ôrh yoxdur. ƒ∞lk ≈ü…ôrh yazan s…ôn ol üòä</p>
            {% endfor %}
        </div>

        <div class="add-comment-section"> {# article-add-comment -> add-comment-section #}
            <h3>≈û…ôrh yaz</h3>

            {% if not request.user.is_authenticated %}
                <p class="comment-auth-message">
                    ≈û…ôrh yazmaq √º√ß√ºn
                    <a href="{% url 'login' %}?next={{ request.path }}">daxil ol</a>
                    v…ô ya
                    <a href="{% url 'register' %}">qeydiyyatdan ke√ß</a>.
                </p>
            {% else %}
                <form method="post" class="comment-form">
                    {% csrf_token %}
                    
                    <div class="form-group">
                        {{ comment_form.text.label_tag }}
                        {{ comment_form.text }}
                        {% if comment_form.text.errors %}
                            <div class="form-error">
                                {{ comment_form.text.errors.0 }}
                            </div>
                        {% endif %}
                    </div>

                  
                    <div class="form-group">
                        {{ comment_form.rating.label_tag }}
                        {{ comment_form.rating }}
                        {% if comment_form.rating.errors %}
                            <div class="form-error">
                                {{ comment_form.rating.errors.0 }}
                            </div>
                        {% endif %}
                    </div>
           
                

                    <button type="submit" class="comment-submit-btn">
                        ≈û…ôrhi G√∂nd…ôr
                    </button>
                </form>
            {% endif %}
        </div>
    </section>
</div>

<footer class="article-footer">
    <a href="{% url 'home' %}" class="back-btn"><i class="fas fa-arrow-left"></i> Ana S…ôhif…ôy…ô Qayƒ±t</a>
</footer>
{% endblock %}